(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};quanto.IntroModalManager=e=function(){function e(){this.receiveMessage=t(this.receiveMessage,this),this.set_version=t(this.set_version,this),this.$research_data=$("#research-data"),this.research_host_url=this.$research_data.data("research-host-url"),this.show_intro_modal=this.$research_data.data("show-intro-modal"),this.$intro_modal=$("#intro-modal"),this.$iframe_elem=$("#nb-iframe"),this.current_step=parseInt(this.$intro_modal.attr("data-step")),this.popover_template=Handlebars.compile('<div class="popover new-notebook-popover" role="tooltip"><div class="arrow"></div><span class="popover-x-out" data-dismiss="modal"></span><div class="popover-content"></div></div>'),this.show_intro_modal&&(this.$intro_modal.modal("show"),mixpanel.track("research intro shown"),this.$intro_modal.on("hidden.bs.modal",function(e){return function(){return e.show_intro_modal=!1,mixpanel.track("research intro hidden",{current_step:e.current_step}),$.post("/users/update_preferences",{prefs:{show_research_intro_modal:e.show_intro_modal}})}}(this))),this.$intro_modal.find("button.next, button.prev").click(function(e){return function(t){var o,a,n;return a=$(t.target),a.hasClass("done")&&(null!=e.version?($("body").animate({scrollTop:0},500),setTimeout(function(){return e.$iframe_elem[0].contentWindow.postMessage({event:"get_button_offset"},e.research_host_url)},600)):e.$intro_modal.modal("hide")),e.current_step=parseInt(e.$intro_modal.attr("data-step")),n=1,o="next",a.hasClass("prev")&&(n=-1,o="previous"),mixpanel.track("research intro "+o+" clicked",{current_step:e.current_step}),e.current_step+=n,e.$intro_modal.attr("data-step",e.current_step)}}(this)),$("#new-notebook").click(function(e){return function(){return e.$intro_modal.modal("hide"),e.$iframe_elem[0].contentWindow.postMessage({event:"new_notebook"},e.research_host_url)}}(this)),this.$intro_modal.find(".step4").click(function(e){return function(){return e.$intro_modal.modal("hide")}}(this)),window.addEventListener("message",this.receiveMessage,!1)}return e.prototype.set_version=function(e){return this.version=e,$("button.done").text("Start a notebook")},e.prototype.receiveMessage=function(e){return e.origin===this.research_host_url&&null!=e.data&&"button_offset"===e.data.event?($("#new-notebook").css("margin-top",e.data.offset.top),$("#new-notebook").addClass("in"),$(".modal-backdrop, #intro-modal").css("position","absolute"),$("body").css("overflow","auto"),$("body").css("padding-right","0"),$("#new-notebook").popover({placement:"bottom",trigger:"manual",content:"Create a new notebook for examples on how to access and plot data.",template:this.popover_template()}),$("#new-notebook").popover("show"),$("#intro-modal").css("overflow","hidden")):void 0},e}()}).call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};quanto.ResearchManager=e=function(){function e(){this.receiveMessage=t(this.receiveMessage,this),this.send_window_dimensions=t(this.send_window_dimensions,this),this.hide_loading_spinner=t(this.hide_loading_spinner,this);var e;this.$iframe_elem=$("#nb-iframe"),this.$feedback_support_checkbox=$("#feedback-modal .checkbox.approve-support"),this.research_data=$("#research-data"),this.$iframe_elem.focus(),this.$body_elem=$("body.full-screen"),this.research_host_url=this.research_data.data("research-host-url"),this.show_notebook_tour=this.research_data.data("show-notebook-tour"),$("#quanto-footer-container").css("padding-top",65),$("#quanto-footer-container").css("padding-bottom",0),_.string.endsWith(this.research_host_url,"/")&&(this.research_host_url=this.research_host_url.substr(0,this.research_host_url.length-1)),this.$cloning_data=$("#cloning-data"),this.$cloning_data.length>0&&mixpanel.track("clone notebook clicked",{thread_id:this.$cloning_data.data("post-id"),thread_title:this.$cloning_data.data("post-title"),creator_id:this.$cloning_data.data("post-creator-id"),creator_email:this.$cloning_data.data("post-creator-email"),notebook_preview_id:this.$cloning_data.data("notebook-preview-id")}),e=null,$(window).scroll(function(t){return function(){return null!=e&&clearTimeout(e),e=setTimeout(t.send_window_dimensions("after_scroll"),500)}}(this)),$("#app-navbar, #quanto-footer-container").on("dragenter",function(){return function(){return $("#nb-iframe").addClass("dragging")}}(this)),$("#nb-iframe").load(function(e){return function(){return setTimeout(e.hide_loading_spinner,2e3)}}(this)),window.addEventListener("message",this.receiveMessage,!1),this.intro_modal_manager=new quanto.IntroModalManager}return e.prototype.hide_loading_spinner=function(){return $(".wrapper").addClass("show-iframe")},e.prototype.send_window_dimensions=function(e){return this.$iframe_elem[0].contentWindow.postMessage({event:e,scrollTop:$(window).scrollTop(),windowHeight:$(window).height()},this.research_host_url)},e.prototype.receiveMessage=function(e){var t,o,a;e.origin===this.research_host_url&&null!=e.data&&(null!=e.data.url?(o=document.createElement("a"),o.href=e.data.url,t=document.createElement("a"),t.href=window.location.href,0===o.pathname.indexOf("/tree")?(t.pathname=o.pathname.replace("tree","research"),this.$body_elem.removeClass("notebook")):(t.pathname="/research"+o.pathname,this.$body_elem.addClass("notebook")),e.data.item_type&&e.data.item_title?(this.$feedback_support_checkbox.removeClass("hide"),this.$feedback_support_checkbox.find("span.item-type").text(e.data.item_type),this.$feedback_support_checkbox.find("span.item-title").text(e.data.item_title)):this.$feedback_support_checkbox.addClass("hide"),t.search=o.search,t.host=window.location.host,window.history.replaceState({},"title",t.href),this.show_notebook_tour&&this.$iframe_elem[0].contentWindow.postMessage({event:"show_tour"},this.research_host_url),null!=e.data.version?(this.version=e.data.version,this.intro_modal_manager.set_version(this.version)):$("body").addClass("old-research")):"show_tour"===e.data.event?(this.show_notebook_tour=e.data.value,$.post("/users/update_preferences",{prefs:{show_notebook_tour:this.show_notebook_tour}})):null!=e.data.height?($("#nb-iframe").height(e.data.height),this.hide_loading_spinner()):null!=e.data.collapsing?e.data.collapsing?this.$body_elem.addClass("hide-header"):this.$body_elem.removeClass("hide-header"):"clone_succeeded"===e.data.event&&this.$cloning_data.length>0&&null!=e.data.notebook_id?$.post("/save_clone_info",{id:this.$cloning_data.data("notebook-preview-id"),notebook_id:e.data.notebook_id}):"dragenter"===e.data.event?($("#nb-iframe").addClass("dragging"),this.send_window_dimensions("after_scroll")):"dragleave"===e.data.event||"drop"===e.data.event?$("#nb-iframe").removeClass("dragging"):"show_modal"===e.data.event?($("#nb-iframe").addClass("show_modal"),this.send_window_dimensions("show_modal")):"hide_modal"===e.data.event?$("#nb-iframe").removeClass("show_modal"):"cell_shared"===e.data.event&&(null!=this.version?(a=encodeURIComponent(e.data.nb_path),window.location.href="/posts/new?p="+a+"&n="+e.data.nb_name+"&i="+e.data.cell_index):quanto.show_error_popup("Sharing notebooks not availabe","We're in the process of deploying updates to sharing, so it's temporarily unavailabe.  Please contact Quantopian feedback for more information.")))},e}()}.call(this);